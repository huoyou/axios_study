<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>axiosFun</title>
  </head>
  <body>
    <button onclick="testGet()">æµ‹è¯•getè¯·æ±‚</button>
    <button onclick="testPost()">æµ‹è¯•postè¯·æ±‚</button>
    <button onclick="testPut()">æµ‹è¯•putè¯·æ±‚</button>
    <button onclick="testDelete()">æµ‹è¯•deleteè¯·æ±‚</button>

    <script>
      function axios({ method = 'get', url, params = {}, data = {} }) {
        return new Promise((resolve, reject) => {
          method = method.toUpperCase();
          let urlStr = '';
          Object.keys(params).forEach((key) => {
            console.log(`ðŸš€ ~ Object.keys ~ key`, key, typeof params);
            urlStr += `${key}=${params[key]}&`;
          });
          if (urlStr) {
            urlStr = urlStr.substring(0, urlStr.length - 1);
            url += `?${urlStr}`;
          }
          const xhr = new XMLHttpRequest();

          xhr.open(method, url, true);

          if (method === 'POST' || method === 'PUT') {
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify(data));
          } else {
            xhr.send();
          }

          xhr.onreadystatechange = function (val) {
            if (xhr.readyState !== 4) {
              return;
            }
            const { status, statusText } = xhr;
            if (status >= 200 && status <= 299) {
              resolve({
                data: JSON.parse(xhr.response),
                status,
                statusText
              });
            } else {
              // reject(new Error('å¤±è´¥äº†'));
              reject({ message: 'å¤±è´¥äº†22' });
            }
          };
        });
      }
      function testGet() {
        axios({
          method: 'get',
          url: 'http://localhost:3000/posts1',
          params: {
            id: 1
          }
        })
          .then((res) => {
            console.log('res', res);
          })
          .catch((err) => {
            console.log(`ðŸš€ ~ testGet ~ err222`, err);
          });
      }
      function testPost() {
        axios({
          method: 'post',
          url: 'http://localhost:3000/posts',
          data: {
            title: '3',
            author: 'xj'
          }
        }).then((res) => {
          console.log('res', res);
        });
      }
      function testPut() {
        axios({
          method: 'put',
          url: 'http://localhost:3000/posts/3',
          data: {
            title: '3---change',
            author: 'xj'
          }
        }).then((res) => {
          console.log('res', res);
        });
      }
      function testDelete() {
        axios({
          method: 'delete',
          url: 'http://localhost:3000/posts/3'
        }).then((res) => {
          console.log('res', res);
        });
      }
    </script>
  </body>
</html>
